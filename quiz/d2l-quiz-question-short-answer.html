<link rel="import" href="../../polymer/polymer-element.html">
<link rel="import" href="./d2l-quiz-question-hint.html">
<link rel="import" href="../../d2l-icons/d2l-icon.html">
<link rel="import" href="../../d2l-icons/tier1-icons.html">
<link rel="import" href="../../d2l-button/d2l-button.html">
<link rel="import" href="../localize-behavior.html">

<!--
'd2l-quiz-question-short-answer'

-->

<dom-module id="d2l-quiz-question-short-answer">
	<template>
		<style>
			:host {
				display: block;
			}

			#d2l-quiz-question {
				max-width: var(--d2l-quiz-question-short-answer-max-width-in-px, 500px);
				width: var(--d2l-quiz-question-short-answer-max-width-in-px, 500px);
			}

			#d2l-quiz-question-body {
				margin-bottom: 1rem;
			}			

			#d2l-quiz-question-hint {
				margin: 1rem 0 0 0;
			}

			.text-area {
				background-color: #fff;
				border-radius: 0.3rem;
				border-style: solid;
				border-color: #d3d9e3;
  				border-width: 1px;
				box-sizing: border-box;
				box-shadow: inset 0 2px 0 0 rgba(185, 194, 208, 0.2);
				display: inline-block;
				min-width: calc(2rem + 1em);
				vertical-align: middle;
				transition-duration: 0.5s;
				transition-timing-function: ease;
				transition-property: background-color, border-color;
				color: #565a5c;
				font-family: inherit;
				font-size: 0.8rem;
				font-weight: 400;
				letter-spacing: 0.02rem;
				line-height: 1.2rem;
  				outline-width: 0;
  				margin: 0 0 0 0.5rem;
  				padding: 0.4rem 0.75rem				
			}

			.text-area:hover, .text-area:focus {
  				border-color: #006fbf;
  				border-width: 2px;
  				outline-width: 0;
  				padding: calc(0.4rem - 1px) calc(0.75rem - 1px);
			}

			.single-row-text-area {
				margin-left: 0;
			}	

			.blank {
				margin-bottom: 0.5rem;
			}

			.spell-check {
				margin-left: 0.5rem;
			}
		</style>

		<div id="d2l-quiz-question">
			<div id="d2l-quiz-question-body" inner-h-t-m-l="[[questionData.bodyText]]" tabindex="0"></div>		
			<div>
				<template is="dom-if" if="[[__isEqualTo(questionData.answers.length, 1)]]">
					<div>
						<textarea class="text-area single-row-text-area" rows="1" style$="width:[[__convertColsToPx(questionData.answers.first.cols, true)]];"></textarea>
						<d2l-button-icon icon="d2l-tier1:spellcheck" class="spell-check" text=[[localize('spell_check')]]></d2l-button-icon>
					</div>
				</template>
				<template is="dom-if" if="[[__isGreaterThan(questionData.answers.length, 1)]]">
					<template is="dom-repeat" items="[[questionData.answers]]">
						<div class="blank">
							<label>[[localize('blank')]] [[__displayIndex(index)]]</label> <textarea class="text-area" rows="[[item.rows]]" style$="width:[[__convertColsToPx(item.cols, false)]];"></textarea>
							<d2l-button-icon icon="d2l-tier1:spellcheck" class="spell-check" text=[[localize('spell_check')]]></d2l-button-icon>
						</div>
					</template>
				</template>
			</div>
			<template is="dom-if" if="[[questionData.hint]]">
				<d2l-quiz-question-hint hint="[[questionData.hint]]"></d2l-quiz-question-hint>
			</template>
		</div>
	</template>

	<script>
		class D2LQuizQuestionShortAnswer extends Polymer.mixinBehaviors(D2L.PolymerBehaviors.D2LQuestion.LocalizeBehavior, Polymer.Element) {
			static get is() {
				return "d2l-quiz-question-short-answer";
			}

			static get properties() {
	      		return {
	        		questionData: {
	          			type: Object,
	          			readOnly: false,
			  			value: () => { return {'bodyText':'I am a test question', 'hint':'this is a hint', 'answers':[{'rows':1, 'cols':20},{'rows':1, 'cols':20},{'rows':1, 'cols':20}]}}
	        		}
	      		}
	    	}

			constructor() {
				super();
			}

			__displayIndex(index) {
				return index + 1;
			}

			__isEqualTo(a, b) {
				return a === b;
			}

			__isGreaterThan(a, b) {
				return a > b;
			}

			__convertColsToPx(cols, singleRow) {
				const maxWidth = parseInt(getComputedStyle(this).getPropertyValue('--d2l-quiz-question-short-answer-max-width-in-px'));
				const desiredWidth = cols == 20 ? 169 : cols == 40 ? 309 : cols == 60 ? 449 : cols * 6.38;
				let actualWidth;
				if (singleRow) {
					actualWidth = (desiredWidth + 55 > maxWidth ? maxWidth - 55 : desiredWidth) + 'px';
				}
				else {
					actualWidth = (desiredWidth + 145 > maxWidth ? maxWidth - 145 : desiredWidth) + 'px';
				}

				return actualWidth;
			}
		}

		customElements.define(D2LQuizQuestionShortAnswer.is, D2LQuizQuestionShortAnswer);
	</script>
</dom-module>
